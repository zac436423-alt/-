<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¤šå°ºå¯¸è´§ç‰©è£…æŸœè®¡ç®—å™¨</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f4f7f9;
            padding: 20px;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: #fff;
            padding: 25px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        h2 {
            text-align: center;
            color: #333;
            border-bottom: 2px solid #007bff;
            padding-bottom: 10px;
            margin-bottom: 20px;
        }
        .cargo-list-header {
            display: flex;
            font-weight: bold;
            padding: 10px 0;
            border-bottom: 1px solid #ddd;
            background-color: #f9f9f9;
        }
        .cargo-list-header > div, .cargo-item > div {
            flex: 1;
            text-align: center;
        }
        .cargo-item {
            display: flex;
            gap: 5px;
            padding: 10px 0;
            border-bottom: 1px dashed #eee;
            align-items: center;
        }
        .cargo-item input[type="number"] {
            width: 90%;
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
            text-align: center;
        }
        #add-cargo-btn, #calculate-btn {
            width: 100%;
            padding: 12px;
            margin-top: 15px;
            background-color: #28a745;
            color: white;
            border: none;
            border-radius: 4px;
            font-size: 16px;
            cursor: pointer;
            transition: background-color 0.3s;
        }
        #calculate-btn {
            background-color: #007bff;
        }
        #calculate-btn:hover { background-color: #0056b3; }
        #add-cargo-btn:hover { background-color: #1e7e34; }
        .remove-btn {
            background-color: #dc3545;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            padding: 5px 10px;
            font-size: 14px;
            width: 100%;
        }
        .remove-btn:hover { background-color: #c82333; }
        .results {
            margin-top: 30px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background-color: #e9ecef;
        }
        .results h3 {
            color: #007bff;
            margin-top: 0;
            margin-bottom: 10px;
        }
        .result-item {
            margin-bottom: 15px;
            padding: 10px;
            background-color: #fff;
            border-radius: 4px;
            border-left: 5px solid #28a745;
        }
        .result-container-header {
            font-weight: bold;
            background-color: #f0f8ff;
            padding: 5px;
            border-radius: 3px;
            margin-bottom: 8px;
        }
        .result-cargo-detail {
            margin-left: 15px;
            font-size: 0.9em;
            line-height: 1.5;
        }
        .cargo-id-col {
            flex: 0.3 !important;
        }
        .action-col {
            flex: 0.5 !important;
        }
    </style>
</head>
<body>

<div class="container">
    <h2>ğŸ“¦ å¤šå°ºå¯¸è´§ç‰©è£…æŸœè®¡ç®—å™¨</h2>

    <h3>å¤šç§è´§ç‰©å°ºå¯¸è¾“å…¥ (å•ä½: cm)</h3>
    <div class="cargo-list-header">
        <div class="cargo-id-col">åºå·</div>
        <div>é•¿ (L)</div>
        <div>å®½ (W)</div>
        <div>é«˜ (H)</div>
        <div class="action-col">æ“ä½œ</div>
    </div>
    
    <div id="cargo-input-area">
        <div class="cargo-item" data-id="1">
            <div class="cargo-id-col">#1</div>
            <div><input type="number" name="L" value="100" min="1" required></div>
            <div><input type="number" name="W" value="80" min="1" required></div>
            <div><input type="number" name="H" value="60" min="1" required></div>
            <div class="action-col"><button class="remove-btn" onclick="removeCargo(this)">åˆ é™¤</button></div>
        </div>
    </div>
    
    <button id="add-cargo-btn" onclick="addCargo()">+ æ·»åŠ ä¸€è¡Œè´§ç‰©å°ºå¯¸</button>

    <button id="calculate-btn" onclick="calculateAllLoading()">è®¡ç®—å…¨éƒ¨è£…è½½é‡</button>

    <div class="results" id="results">
        <h3>è®¡ç®—ç»“æœ</h3>
        <p>è¾“å…¥å¤šç§è´§ç‰©å°ºå¯¸åç‚¹å‡»ä¸Šæ–¹æŒ‰é’®è¿›è¡Œè®¡ç®—ã€‚</p>
    </div>
</div>

<script>
    // --- æ ¸å¿ƒæ•°æ®ï¼šé›†è£…ç®±å†…éƒ¨å¯ç”¨å°ºå¯¸ (ä»¥ cm ä¸ºå•ä½) ---
    const CONTAINER_SPECS = {
        '20GP': { name: '20å°ºæ™®é€šæŸœ (20\'GP)', L: 589.8, W: 235.2, H: 238.5 },
        '40GP': { name: '40å°ºæ™®é€šæŸœ (40\'GP)', L: 1203.2, W: 235.2, H: 238.5 },
        '40HQ': { name: '40å°ºé«˜æŸœ (40\'HQ)', L: 1203.2, W: 235.2, H: 269.0 }
    };
    let cargoCount = 1;

    /**
     * è¾…åŠ©å‡½æ•°ï¼šæ·»åŠ ä¸€è¡Œè´§ç‰©å°ºå¯¸è¾“å…¥
     */
    function addCargo() {
        cargoCount++;
        const inputArea = document.getElementById('cargo-input-area');
        const newItem = document.createElement('div');
        newItem.className = 'cargo-item';
        newItem.setAttribute('data-id', cargoCount);
        newItem.innerHTML = `
            <div class="cargo-id-col">#${cargoCount}</div>
            <div><input type="number" name="L" value="100" min="1" required></div>
            <div><input type="number" name="W" value="80" min="1" required></div>
            <div><input type="number" name="H" value="60" min="1" required></div>
            <div class="action-col"><button class="remove-btn" onclick="removeCargo(this)">åˆ é™¤</button></div>
        `;
        inputArea.appendChild(newItem);
    }

    /**
     * è¾…åŠ©å‡½æ•°ï¼šåˆ é™¤ä¸€è¡Œè´§ç‰©å°ºå¯¸è¾“å…¥
     */
    function removeCargo(button) {
        const itemToRemove = button.closest('.cargo-item');
        itemToRemove.remove();
        // é‡æ–°æ›´æ–°åºå·æ˜¾ç¤º
        updateCargoNumbers();
    }
    
    /**
     * è¾…åŠ©å‡½æ•°ï¼šæ›´æ–°è´§ç‰©åºå·æ˜¾ç¤º
     */
    function updateCargoNumbers() {
        const items = document.querySelectorAll('.cargo-item');
        items.forEach((item, index) => {
            item.querySelector('.cargo-id-col').textContent = `#${index + 1}`;
            item.setAttribute('data-id', index + 1);
        });
        cargoCount = items.length > 0 ? items.length : 0;
    }


    /**
     * è®¡ç®—ç‰¹å®šæ‘†æ”¾ä¸‹èƒ½è£…è½½çš„ä»¶æ•°
     */
    function getPieces(Lc, Wc, Hc, Li, Wi, Hi) {
        if (Li <= 0 || Wi <= 0 || Hi <= 0) return 0;
        
        const N_L = Math.floor(Lc / Li);
        const N_W = Math.floor(Wc / Wi);
        const N_H = Math.floor(Hc / Hi);

        return N_L * N_W * N_H;
    }

    /**
     * è®¡ç®—**å•ç§**è´§ç‰©åœ¨**æ‰€æœ‰**è´§æŸœä¸­çš„æœ€å¤§è£…è½½é‡
     */
    function calculateSingleItemLoading(itemL, itemW, itemH, containerKey) {
        const container = CONTAINER_SPECS[containerKey];
        const Lc = container.L;
        const Wc = container.W;
        const Hc = container.H;

        // 6ç§è½´å¯¹é½æ‘†æ”¾æ–¹å¼ (LxWxH, LxHxW, WxLxH, WxHxL, HxLxW, HxWxL)
        const orientations = [
            { pieces: getPieces(Lc, Wc, Hc, itemL, itemW, itemH), name: `${itemL}Ã—${itemW}Ã—${itemH}` },
            { pieces: getPieces(Lc, Wc, Hc, itemL, itemH, itemW), name: `${itemL}Ã—${itemH}Ã—${itemW}` },
            { pieces: getPieces(Lc, Wc, Hc, itemW, itemL, itemH), name: `${itemW}Ã—${itemL}Ã—${itemH}` },
            { pieces: getPieces(Lc, Wc, Hc, itemW, itemH, itemL), name: `${itemW}Ã—${itemH}Ã—${itemL}` },
            { pieces: getPieces(Lc, Wc, Hc, itemH, itemL, itemW), name: `${itemH}Ã—${itemL}Ã—${itemW}` },
            { pieces: getPieces(Lc, Wc, Hc, itemH, itemW, itemL), name: `${itemH}Ã—${itemW}Ã—${itemL}` }
        ];

        let maxPieces = 0;
        let bestOrientation = '';

        orientations.forEach(orientation => {
            if (orientation.pieces > maxPieces) {
                maxPieces = orientation.pieces;
                bestOrientation = orientation.name;
            }
        });

        return { maxPieces, bestOrientation };
    }

    /**
     * ä¸»å‡½æ•°ï¼šéå†æ‰€æœ‰è¾“å…¥ï¼Œå¹¶è®¡ç®—æ‰€æœ‰è´§æŸœçš„è£…è½½é‡
     */
    function calculateAllLoading() {
        const cargoItems = document.querySelectorAll('.cargo-item');
        const resultsDiv = document.getElementById('results');
        const cargoInputs = [];

        // 1. æ”¶é›†å’ŒéªŒè¯æ‰€æœ‰è´§ç‰©è¾“å…¥
        cargoItems.forEach(item => {
            const L = parseFloat(item.querySelector('input[name="L"]').value);
            const W = parseFloat(item.querySelector('input[name="W"]').value);
            const H = parseFloat(item.querySelector('input[name="H"]').value);
            const id = item.getAttribute('data-id');

            if (isNaN(L) || isNaN(W) || isNaN(H) || L <= 0 || W <= 0 || H <= 0) {
                resultsDiv.innerHTML = `<h3>è®¡ç®—ç»“æœ</h3><p style="color: red;">è¯·æ£€æŸ¥ #${id} è´§ç‰©ï¼Œè¾“å…¥æœ‰æ•ˆçš„é•¿ã€å®½ã€é«˜ã€‚</p>`;
                return; // è·³å‡ºå½“å‰å¾ªç¯ï¼Œä½†ä¸ç»ˆæ­¢å‡½æ•°
            }

            cargoInputs.push({ L, W, H, id });
        });

        if (cargoInputs.length === 0) {
            resultsDiv.innerHTML = '<h3>è®¡ç®—ç»“æœ</h3><p>è¯·è‡³å°‘æ·»åŠ ä¸€è¡Œè´§ç‰©å°ºå¯¸ã€‚</p>';
            return;
        }

        let outputHTML = '<h3>è®¡ç®—ç»“æœ (è½´å¯¹é½æ‘†æ”¾çš„æœ€å¤§ä»¶æ•°)</h3>';

        // 2. éå†æ‰€æœ‰è´§æŸœç±»å‹
        for (const containerKey in CONTAINER_SPECS) {
            const container = CONTAINER_SPECS[containerKey];
            outputHTML += `<div class="result-item">`;
            outputHTML += `<div class="result-container-header">ğŸš¢ ${container.name} (å†…éƒ¨å°ºå¯¸: ${container.L}x${container.W}x${container.H} cm)</div>`;

            // 3. éå†æ‰€æœ‰è´§ç‰©å°ºå¯¸ï¼Œè®¡ç®—åœ¨è¯¥è´§æŸœä¸­çš„è£…è½½é‡
            cargoInputs.forEach(cargo => {
                const { maxPieces, bestOrientation } = calculateSingleItemLoading(cargo.L, cargo.W, cargo.H, containerKey);

                outputHTML += `
                    <div class="result-cargo-detail">
                        <strong>è´§ç‰© #${cargo.id} (${cargo.L}Ã—${cargo.W}Ã—${cargo.H} cm):</strong>
                        å¯è£…è½½ 
                        <span style="font-size: 1.1em; color: #dc3545; font-weight: bold;">${maxPieces}</span> ä»¶
                        <br>
                        <small>ï¼ˆæœ€ä½³æ‘†æ”¾ï¼š${bestOrientation} å¯¹åº”è´§æŸœé•¿Ã—å®½Ã—é«˜ï¼‰</small>
                    </div>
                `;
            });

            outputHTML += `</div>`; // ç»“æŸ result-item
        }

        resultsDiv.innerHTML = outputHTML;
    }
</script>

</body>
</html>
