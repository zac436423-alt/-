<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é›†è£…ç®±æ··è£…ä½“ç§¯ä¸å åœ°é¢ç§¯è®¡ç®—å™¨</title>
    <style>
        /* (CSS æ ·å¼ä¸ä¸Šä¸€ä¸ªç‰ˆæœ¬ç›¸ä¼¼ï¼Œç•¥æœ‰è°ƒæ•´) */
        body { font-family: Arial, sans-serif; background-color: #f4f7f9; padding: 20px; }
        .container { max-width: 950px; margin: 0 auto; background: #fff; padding: 25px; border-radius: 8px; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); }
        h2 { text-align: center; color: #333; border-bottom: 2px solid #007bff; padding-bottom: 10px; margin-bottom: 20px; }
        .cargo-list-header { display: flex; font-weight: bold; padding: 10px 0; border-bottom: 1px solid #ddd; background-color: #f9f9f9; }
        .cargo-list-header > div, .cargo-item > div { flex: 1; text-align: center; }
        .cargo-item { display: flex; gap: 5px; padding: 10px 0; border-bottom: 1px dashed #eee; align-items: center; }
        .cargo-item input[type="number"] { width: 90%; padding: 8px; border: 1px solid #ccc; border-radius: 4px; text-align: center; }
        .cargo-item .col-qty { flex: 0.8; }
        .cargo-item .col-size { flex: 1.2; }
        #add-cargo-btn, #calculate-btn { width: 100%; padding: 12px; margin-top: 15px; background-color: #28a745; color: white; border: none; border-radius: 4px; font-size: 16px; cursor: pointer; transition: background-color 0.3s; }
        #calculate-btn { background-color: #007bff; }
        #calculate-btn:hover { background-color: #0056b3; }
        #add-cargo-btn:hover { background-color: #1e7e34; }
        .remove-btn { background-color: #dc3545; color: white; border: none; border-radius: 4px; cursor: pointer; padding: 5px 10px; font-size: 14px; width: 100%; }
        .remove-btn:hover { background-color: #c82333; }
        .results { margin-top: 30px; padding: 15px; border: 1px solid #ddd; border-radius: 4px; background-color: #e9ecef; }
        .results h3 { color: #007bff; margin-top: 0; margin-bottom: 10px; }
        .result-container-header { font-weight: bold; background-color: #f0f8ff; padding: 10px; border-radius: 3px; margin-bottom: 8px; }
        .volume-detail { font-size: 1.1em; line-height: 1.8; }
        .alert-success { color: green; font-weight: bold; }
        .alert-danger { color: red; font-weight: bold; }
        .control-group { display: flex; align-items: center; justify-content: space-between; margin-bottom: 20px; border-bottom: 1px solid #ddd; padding-bottom: 10px; }
        .control-group label { margin-right: 15px; font-weight: bold; }
        select { padding: 10px; border-radius: 4px; border: 1px solid #ccc; }
    </style>
</head>
<body>

<div class="container">
    <h2>ğŸ“¦ é›†è£…ç®±æ··è£…ä½“ç§¯ä¸å åœ°é¢ç§¯è®¡ç®—å™¨</h2>

    <div class="control-group">
        <div>
            <label for="container-select">é€‰æ‹©é›†è£…ç®±å‹å·:</label>
            <select id="container-select">
                <option value="20GP">20å°ºæ™®é€šæŸœ (20'GP)</option>
                <option value="40GP" selected>40å°ºæ™®é€šæŸœ (40'GP)</option>
                <option value="40HQ">40å°ºé«˜æŸœ (40'HQ)</option>
            </select>
        </div>
        <div>
            <label for="area-basis">å åœ°é¢ç§¯è®¡ç®—åŸºå‡†:</label>
            <select id="area-basis">
                <option value="LW">é•¿ $\times$ å®½ (LÃ—W)</option>
                <option value="WH">å®½ $\times$ é«˜ (WÃ—H)</option>
                <option value="LH">é•¿ $\times$ é«˜ (LÃ—H)</option>
                <option value="MIN_AREA">æœ€å°å åœ°é¢ç§¯</option>
            </select>
        </div>
    </div>

    <h3>è´§ç‰©åˆ—è¡¨ (å°ºå¯¸å•ä½: cm, æ•°é‡: ä»¶)</h3>
    <div class="cargo-list-header">
        <div>åºå·</div>
        <div class="col-size">é•¿ (L)</div>
        <div class="col-size">å®½ (W)</div>
        <div class="col-size">é«˜ (H)</div>
        <div class="col-qty">ä»¶æ•° (N)</div>
        <div>æ“ä½œ</div>
    </div>
    
    <div id="cargo-input-area">
        <div class="cargo-item" data-id="1">
            <div>#1</div>
            <div class="col-size"><input type="number" name="L" value="100" min="1" required></div>
            <div class="col-size"><input type="number" name="W" value="100" min="1" required></div>
            <div class="col-size"><input type="number" name="H" value="100" min="1" required></div>
            <div class="col-qty"><input type="number" name="N" value="10" min="1" required></div>
            <div><button class="remove-btn" onclick="removeCargo(this)">åˆ é™¤</button></div>
        </div>
        <div class="cargo-item" data-id="2">
            <div>#2</div>
            <div class="col-size"><input type="number" name="L" value="80" min="1" required></div>
            <div class="col-size"><input type="number" name="W" value="60" min="1" required></div>
            <div class="col-size"><input type="number" name="H" value="50" min="1" required></div>
            <div class="col-qty"><input type="number" name="N" value="50" min="1" required></div>
            <div><button class="remove-btn" onclick="removeCargo(this)">åˆ é™¤</button></div>
        </div>
    </div>
    
    <button id="add-cargo-btn" onclick="addCargo()">+ æ·»åŠ ä¸€è¡Œè´§ç‰©å°ºå¯¸å’Œä»¶æ•°</button>

    <button id="calculate-btn" onclick="calculateMixedLoading()">è®¡ç®—æ··è£…ä½“ç§¯ä¸å åœ°é¢ç§¯</button>

    <div class="results" id="results">
        <h3>è®¡ç®—ç»“æœ</h3>
        <p>é€‰æ‹©è´§æŸœå’Œå åœ°é¢ç§¯åŸºå‡†ï¼Œå¹¶è¾“å…¥å¤šè¡Œè´§ç‰©å°ºå¯¸ä¸ä»¶æ•°åï¼Œç‚¹å‡»ä¸Šæ–¹æŒ‰é’®è®¡ç®—ã€‚</p>
    </div>
</div>

<script>
    // --- æ ¸å¿ƒæ•°æ®ï¼šé›†è£…ç®±å†…éƒ¨å¯ç”¨å°ºå¯¸åŠä½“ç§¯ (ä»¥ cm ä¸ºå•ä½) ---
    const CONTAINER_SPECS = {
        '20GP': { name: '20å°ºæ™®é€šæŸœ', L: 589.8, W: 235.2, H: 238.5, V_m3: 33.1, Area_m2: 13.87 }, // Area_m2 = L*W/10000
        '40GP': { name: '40å°ºæ™®é€šæŸœ', L: 1203.2, W: 235.2, H: 238.5, V_m3: 67.5, Area_m2: 28.30 },
        '40HQ': { name: '40å°ºé«˜æŸœ', L: 1203.2, W: 235.2, H: 269.0, V_m3: 76.2, Area_m2: 28.30 }
    };
    let cargoCount = 2; // åˆå§‹è´§ç‰©è®¡æ•°

    /**
     * è¾…åŠ©å‡½æ•°ï¼šæ·»åŠ ä¸€è¡Œè´§ç‰©å°ºå¯¸è¾“å…¥
     */
    function addCargo() {
        cargoCount++;
        const inputArea = document.getElementById('cargo-input-area');
        const newItem = document.createElement('div');
        newItem.className = 'cargo-item';
        newItem.setAttribute('data-id', cargoCount);
        newItem.innerHTML = `
            <div>#${cargoCount}</div>
            <div class="col-size"><input type="number" name="L" value="50" min="1" required></div>
            <div class="col-size"><input type="number" name="W" value="50" min="1" required></div>
            <div class="col-size"><input type="number" name="H" value="50" min="1" required></div>
            <div class="col-qty"><input type="number" name="N" value="20" min="1" required></div>
            <div><button class="remove-btn" onclick="removeCargo(this)">åˆ é™¤</button></div>
        `;
        inputArea.appendChild(newItem);
        updateCargoNumbers();
    }

    /**
     * è¾…åŠ©å‡½æ•°ï¼šåˆ é™¤ä¸€è¡Œè´§ç‰©å°ºå¯¸è¾“å…¥å¹¶æ›´æ–°åºå·
     */
    function removeCargo(button) {
        const itemToRemove = button.closest('.cargo-item');
        if (document.querySelectorAll('.cargo-item').length > 1) {
             itemToRemove.remove();
             updateCargoNumbers();
        } else {
            alert("è‡³å°‘éœ€è¦ä¿ç•™ä¸€ç§è´§ç‰©ï¼");
        }
    }
    
    /**
     * è¾…åŠ©å‡½æ•°ï¼šæ›´æ–°è´§ç‰©åºå·æ˜¾ç¤º
     */
    function updateCargoNumbers() {
        const items = document.querySelectorAll('.cargo-item');
        items.forEach((item, index) => {
            item.querySelector('div:first-child').textContent = `#${index + 1}`;
            item.setAttribute('data-id', index + 1);
        });
        cargoCount = items.length;
    }

    /**
     * è®¡ç®—å•ä»¶è´§ç‰©çš„å åœ°é¢ç§¯ (å•ä½: mÂ²)
     * @param {number} L, W, H è´§ç‰©å°ºå¯¸ (cm)
     * @param {string} basis é¢ç§¯è®¡ç®—åŸºå‡† (LW, WH, LH, MIN_AREA)
     * @returns {number} å•ä»¶å åœ°é¢ç§¯ (mÂ²)
     */
    function calculateSingleItemArea(L, W, H, basis) {
        let area_cm2 = 0;
        
        switch (basis) {
            case 'LW':
                area_cm2 = L * W;
                break;
            case 'WH':
                area_cm2 = W * H;
                break;
            case 'LH':
                area_cm2 = L * H;
                break;
            case 'MIN_AREA':
                // æ‰¾å‡ºä¸‰ä¸ªé¢ä¸­é¢ç§¯æœ€å°çš„ä½œä¸ºå åœ°é¢ç§¯
                const areas = [L * W, W * H, L * H];
                area_cm2 = Math.min(...areas);
                break;
        }
        
        // è½¬æ¢ä¸º mÂ² (é™¤ä»¥ 10000)
        return area_cm2 / 10000;
    }


    /**
     * ä¸»å‡½æ•°ï¼šè®¡ç®—æ··è£…ä½“ç§¯åˆ©ç”¨ç‡å’Œæ€»å åœ°é¢ç§¯
     */
    function calculateMixedLoading() {
        const cargoItems = document.querySelectorAll('.cargo-item');
        const resultsDiv = document.getElementById('results');
        const containerKey = document.getElementById('container-select').value;
        const areaBasis = document.getElementById('area-basis').value;
        const container = CONTAINER_SPECS[containerKey];
        
        let totalCargoVolume_cm3 = 0;
        let totalCargoArea_m2 = 0; // æ–°å¢ï¼šæ€»å åœ°é¢ç§¯
        let totalCargoCount = 0;
        let valid = true;

        // 1. æ”¶é›†å’ŒéªŒè¯æ‰€æœ‰è´§ç‰©è¾“å…¥å¹¶è®¡ç®—æ€»ä½“ç§¯å’Œæ€»é¢ç§¯
        cargoItems.forEach(item => {
            const L = parseFloat(item.querySelector('input[name="L"]').value);
            const W = parseFloat(item.querySelector('input[name="W"]').value);
            const H = parseFloat(item.querySelector('input[name="H"]').value);
            const N = parseFloat(item.querySelector('input[name="N"]').value);
            const id = item.getAttribute('data-id');

            if (isNaN(L) || isNaN(W) || isNaN(H) || isNaN(N) || L <= 0 || W <= 0 || H <= 0 || N < 1) {
                resultsDiv.innerHTML = `<h3>è®¡ç®—ç»“æœ</h3><p class="alert-danger">è¯·æ£€æŸ¥ #${id} è´§ç‰©ï¼Œè¾“å…¥æœ‰æ•ˆçš„å°ºå¯¸å’Œä»¶æ•°ã€‚</p>`;
                valid = false;
                return;
            }

            // è®¡ç®—ä½“ç§¯
            const singleVolume_cm3 = L * W * H;
            totalCargoVolume_cm3 += singleVolume_cm3 * N;
            totalCargoCount += N;
            
            // è®¡ç®—å åœ°é¢ç§¯ (mÂ²)
            const singleArea_m2 = calculateSingleItemArea(L, W, H, areaBasis);
            totalCargoArea_m2 += singleArea_m2 * N;
        });

        if (!valid) return;
        if (totalCargoCount === 0) {
             resultsDiv.innerHTML = '<h3>è®¡ç®—ç»“æœ</h3><p>è¯·è‡³å°‘è¾“å…¥ä¸€ç§è´§ç‰©åŠå…¶ä»¶æ•°ã€‚</p>';
             return;
        }

        // 2. è´§æŸœä½“ç§¯å’Œé¢ç§¯æ•°æ®
        const containerVolume_cm3 = container.L * container.W * container.H;
        const containerVolume_m3 = containerVolume_cm3 / 1000000; 
        const containerArea_m2 = container.Area_m2; // è´§æŸœåº•é¢ç§¯

        // 3. è®¡ç®—åˆ©ç”¨ç‡
        const volumeUtilizationRate = (totalCargoVolume_cm3 / containerVolume_cm3) * 100;
        // å åœ°é¢ç§¯åˆ©ç”¨ç‡ï¼ˆå‡è®¾è´§ç‰©å¯ä»¥å®Œç¾ç´§å¯†å †å ä¸€å±‚ï¼‰
        const areaUtilizationRate = (totalCargoArea_m2 / containerArea_m2) * 100;
        
        let outputHTML = '<h3>ä½“ç§¯ä¸å åœ°é¢ç§¯ä¼°ç®—ç»“æœ</h3>';
        
        // ç»“æœåŒºåŸŸ
        outputHTML += `
            <div class="result-container-header">
                ğŸš¢ ${container.name} 
                ï¼ˆç†è®ºå®¹ç§¯: ${containerVolume_m3.toFixed(3)} mÂ³ | åº•éƒ¨é¢ç§¯: ${containerArea_m2.toFixed(2)} mÂ²ï¼‰
            </div>
            <div class="volume-detail">
                <p><strong>ğŸ“¦ å¾…è£…è´§ç‰©æ€»ä»¶æ•°:</strong> ${totalCargoCount} ä»¶</p>
                <hr>
                
                <h4>ä½“ç§¯è®¡ç®— (CBM)</h4>
                <p><strong>æ€»è´§ç‰©æ€»ä½“ç§¯ (CBM):</strong> ${(totalCargoVolume_cm3 / 1000000).toFixed(3)} mÂ³</p>
                <p><strong>ä½“ç§¯åˆ©ç”¨ç‡:</strong> ${volumeUtilizationRate.toFixed(2)} %</p>
        `;

        // 4. ä½“ç§¯åˆ¤æ–­
        if (volumeUtilizationRate > 100) {
            outputHTML += `<p class="alert-danger">âš ï¸ è­¦å‘Šï¼šæ€»ä½“ç§¯è¶…å®¹ (${volumeUtilizationRate.toFixed(2)}%)ï¼Œæ— æ³•è£…å…¥ï¼</p>`;
        } else if (volumeUtilizationRate > 85) {
             outputHTML += `<p class="alert-success">ğŸ‘ ä½“ç§¯åˆ©ç”¨ç‡é«˜ï¼Œç†è®ºä¸Šå¯è£…è½½ã€‚</p>`;
        } else {
            outputHTML += `<p class="alert-success">ğŸ‘ ä½“ç§¯è¶³å¤Ÿï¼Œå°šæœ‰ä½™é‡ã€‚</p>`;
        }
        
        // 5. å åœ°é¢ç§¯åˆ¤æ–­
        outputHTML += `<hr>
                <h4>å åœ°é¢ç§¯è®¡ç®— (MÂ²)</h4>
                <p><strong>æ€»è´§ç‰©å åœ°é¢ç§¯ (MÂ²):</strong> <span style="font-size: 1.1em; color: #dc3545;">${totalCargoArea_m2.toFixed(2)} mÂ²</span> (æŒ‰ ${areaBasis} é¢è®¡ç®—)</p>
                <p><strong>å•å±‚é¢ç§¯åˆ©ç”¨ç‡:</strong> ${areaUtilizationRate.toFixed(2)} %</p>`;

        if (areaUtilizationRate > 100) {
            outputHTML += `<p class="alert-danger">âš ï¸ è­¦å‘Šï¼šæ€»å åœ°é¢ç§¯ (${totalCargoArea_m2.toFixed(2)} mÂ²) å·²è¶…è¿‡è´§æŸœåº•éƒ¨é¢ç§¯ï¼Œ**è´§ç‰©éœ€è¦å †å å¤šå±‚**æ‰èƒ½è£…å…¥ï¼</p>`;
        } else if (areaUtilizationRate > 90) {
            outputHTML += `<p class="alert-success">ğŸ‘ å•å±‚é¢ç§¯åˆ©ç”¨ç‡æé«˜ï¼Œéœ€ä¸¥å¯†æ‘†æ”¾ï¼Œå¯èƒ½åªéœ€å †å ä¸€å±‚ã€‚</p>`;
        } else {
            outputHTML += `<p>å•å±‚é¢ç§¯è¶³å¤Ÿï¼Œä¸éœ€è¦æˆ–åªéœ€å°‘é‡å †å ã€‚</p>`;
        }
        
        outputHTML += `</div>`;
        resultsDiv.innerHTML = outputHTML;
    }
</script>

</body>
</html>
