<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é›†è£…ç®±æ··è£…ä½“ç§¯è®¡ç®—å™¨</title>
    <style>
        /* (CSS æ ·å¼ä¸ä¸Šä¸€ä¸ªç‰ˆæœ¬ç›¸ä¼¼ï¼Œç•¥æœ‰è°ƒæ•´) */
        body { font-family: Arial, sans-serif; background-color: #f4f7f9; padding: 20px; }
        .container { max-width: 900px; margin: 0 auto; background: #fff; padding: 25px; border-radius: 8px; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1); }
        h2 { text-align: center; color: #333; border-bottom: 2px solid #007bff; padding-bottom: 10px; margin-bottom: 20px; }
        .cargo-list-header { display: flex; font-weight: bold; padding: 10px 0; border-bottom: 1px solid #ddd; background-color: #f9f9f9; }
        .cargo-list-header > div, .cargo-item > div { flex: 1; text-align: center; }
        .cargo-item { display: flex; gap: 5px; padding: 10px 0; border-bottom: 1px dashed #eee; align-items: center; }
        .cargo-item input[type="number"] { width: 90%; padding: 8px; border: 1px solid #ccc; border-radius: 4px; text-align: center; }
        .cargo-item .col-qty { flex: 0.8; }
        .cargo-item .col-size { flex: 1.2; }
        #add-cargo-btn, #calculate-btn { width: 100%; padding: 12px; margin-top: 15px; background-color: #28a745; color: white; border: none; border-radius: 4px; font-size: 16px; cursor: pointer; transition: background-color 0.3s; }
        #calculate-btn { background-color: #007bff; }
        #calculate-btn:hover { background-color: #0056b3; }
        #add-cargo-btn:hover { background-color: #1e7e34; }
        .remove-btn { background-color: #dc3545; color: white; border: none; border-radius: 4px; cursor: pointer; padding: 5px 10px; font-size: 14px; width: 100%; }
        .remove-btn:hover { background-color: #c82333; }
        .results { margin-top: 30px; padding: 15px; border: 1px solid #ddd; border-radius: 4px; background-color: #e9ecef; }
        .results h3 { color: #007bff; margin-top: 0; margin-bottom: 10px; }
        .result-container-header { font-weight: bold; background-color: #f0f8ff; padding: 10px; border-radius: 3px; margin-bottom: 8px; }
        .volume-detail { font-size: 1.1em; line-height: 1.8; }
        .alert-success { color: green; font-weight: bold; }
        .alert-danger { color: red; font-weight: bold; }
        .select-group { display: flex; align-items: center; margin-bottom: 20px; }
        .select-group label { margin-right: 15px; font-weight: bold; }
        #container-select { padding: 10px; border-radius: 4px; border: 1px solid #ccc; }
    </style>
</head>
<body>

<div class="container">
    <h2>ğŸ“¦ é›†è£…ç®±æ··è£…ä½“ç§¯ä¸ç©ºé—´åˆ©ç”¨ç‡è®¡ç®—å™¨</h2>

    <div class="select-group">
        <label for="container-select">é€‰æ‹©é›†è£…ç®±å‹å·:</label>
        <select id="container-select">
            <option value="20GP">20å°ºæ™®é€šæŸœ (20'GP)</option>
            <option value="40GP" selected>40å°ºæ™®é€šæŸœ (40'GP)</option>
            <option value="40HQ">40å°ºé«˜æŸœ (40'HQ)</option>
        </select>
    </div>

    <h3>è´§ç‰©åˆ—è¡¨ (å°ºå¯¸å•ä½: cm, æ•°é‡: ä»¶)</h3>
    <div class="cargo-list-header">
        <div>åºå·</div>
        <div class="col-size">é•¿ (L)</div>
        <div class="col-size">å®½ (W)</div>
        <div class="col-size">é«˜ (H)</div>
        <div class="col-qty">ä»¶æ•° (N)</div>
        <div>æ“ä½œ</div>
    </div>
    
    <div id="cargo-input-area">
        <div class="cargo-item" data-id="1">
            <div>#1</div>
            <div class="col-size"><input type="number" name="L" value="100" min="1" required></div>
            <div class="col-size"><input type="number" name="W" value="100" min="1" required></div>
            <div class="col-size"><input type="number" name="H" value="100" min="1" required></div>
            <div class="col-qty"><input type="number" name="N" value="10" min="1" required></div>
            <div><button class="remove-btn" onclick="removeCargo(this)">åˆ é™¤</button></div>
        </div>
        <div class="cargo-item" data-id="2">
            <div>#2</div>
            <div class="col-size"><input type="number" name="L" value="80" min="1" required></div>
            <div class="col-size"><input type="number" name="W" value="60" min="1" required></div>
            <div class="col-size"><input type="number" name="H" value="50" min="1" required></div>
            <div class="col-qty"><input type="number" name="N" value="50" min="1" required></div>
            <div><button class="remove-btn" onclick="removeCargo(this)">åˆ é™¤</button></div>
        </div>
    </div>
    
    <button id="add-cargo-btn" onclick="addCargo()">+ æ·»åŠ ä¸€è¡Œè´§ç‰©å°ºå¯¸å’Œä»¶æ•°</button>

    <button id="calculate-btn" onclick="calculateMixedLoading()">è®¡ç®—æ··è£…ä½“ç§¯åˆ©ç”¨ç‡</button>

    <div class="results" id="results">
        <h3>è®¡ç®—ç»“æœ</h3>
        <p>é€‰æ‹©è´§æŸœå¹¶è¾“å…¥å¤šè¡Œè´§ç‰©å°ºå¯¸ä¸ä»¶æ•°åï¼Œç‚¹å‡»ä¸Šæ–¹æŒ‰é’®è®¡ç®—ã€‚</p>
    </div>
</div>

<script>
    // --- æ ¸å¿ƒæ•°æ®ï¼šé›†è£…ç®±å†…éƒ¨å¯ç”¨å°ºå¯¸åŠä½“ç§¯ (ä»¥ cm ä¸ºå•ä½) ---
    const CONTAINER_SPECS = {
        '20GP': { name: '20å°ºæ™®é€šæŸœ', L: 589.8, W: 235.2, H: 238.5, V_m3: 33.1 },
        '40GP': { name: '40å°ºæ™®é€šæŸœ', L: 1203.2, W: 235.2, H: 238.5, V_m3: 67.5 },
        '40HQ': { name: '40å°ºé«˜æŸœ', L: 1203.2, W: 235.2, H: 269.0, V_m3: 76.2 }
    };
    let cargoCount = 2; // åˆå§‹è´§ç‰©è®¡æ•°

    /**
     * è¾…åŠ©å‡½æ•°ï¼šæ·»åŠ ä¸€è¡Œè´§ç‰©å°ºå¯¸è¾“å…¥
     */
    function addCargo() {
        cargoCount++;
        const inputArea = document.getElementById('cargo-input-area');
        const newItem = document.createElement('div');
        newItem.className = 'cargo-item';
        newItem.setAttribute('data-id', cargoCount);
        newItem.innerHTML = `
            <div>#${cargoCount}</div>
            <div class="col-size"><input type="number" name="L" value="50" min="1" required></div>
            <div class="col-size"><input type="number" name="W" value="50" min="1" required></div>
            <div class="col-size"><input type="number" name="H" value="50" min="1" required></div>
            <div class="col-qty"><input type="number" name="N" value="20" min="1" required></div>
            <div><button class="remove-btn" onclick="removeCargo(this)">åˆ é™¤</button></div>
        `;
        inputArea.appendChild(newItem);
        updateCargoNumbers();
    }

    /**
     * è¾…åŠ©å‡½æ•°ï¼šåˆ é™¤ä¸€è¡Œè´§ç‰©å°ºå¯¸è¾“å…¥å¹¶æ›´æ–°åºå·
     */
    function removeCargo(button) {
        const itemToRemove = button.closest('.cargo-item');
        if (document.querySelectorAll('.cargo-item').length > 1) {
             itemToRemove.remove();
             updateCargoNumbers();
        } else {
            alert("è‡³å°‘éœ€è¦ä¿ç•™ä¸€ç§è´§ç‰©ï¼");
        }
    }
    
    /**
     * è¾…åŠ©å‡½æ•°ï¼šæ›´æ–°è´§ç‰©åºå·æ˜¾ç¤º
     */
    function updateCargoNumbers() {
        const items = document.querySelectorAll('.cargo-item');
        items.forEach((item, index) => {
            item.querySelector('div:first-child').textContent = `#${index + 1}`;
            item.setAttribute('data-id', index + 1);
        });
        cargoCount = items.length;
    }


    /**
     * ä¸»å‡½æ•°ï¼šè®¡ç®—æ··è£…ä½“ç§¯åˆ©ç”¨ç‡
     */
    function calculateMixedLoading() {
        const cargoItems = document.querySelectorAll('.cargo-item');
        const resultsDiv = document.getElementById('results');
        const containerKey = document.getElementById('container-select').value;
        const container = CONTAINER_SPECS[containerKey];
        
        let totalCargoVolume_cm3 = 0;
        let totalCargoCount = 0;
        let valid = true;

        // 1. æ”¶é›†å’ŒéªŒè¯æ‰€æœ‰è´§ç‰©è¾“å…¥å¹¶è®¡ç®—æ€»ä½“ç§¯
        cargoItems.forEach(item => {
            const L = parseFloat(item.querySelector('input[name="L"]').value);
            const W = parseFloat(item.querySelector('input[name="W"]').value);
            const H = parseFloat(item.querySelector('input[name="H"]').value);
            const N = parseFloat(item.querySelector('input[name="N"]').value);
            const id = item.getAttribute('data-id');

            if (isNaN(L) || isNaN(W) || isNaN(H) || isNaN(N) || L <= 0 || W <= 0 || H <= 0 || N < 1) {
                resultsDiv.innerHTML = `<h3>è®¡ç®—ç»“æœ</h3><p class="alert-danger">è¯·æ£€æŸ¥ #${id} è´§ç‰©ï¼Œè¾“å…¥æœ‰æ•ˆçš„å°ºå¯¸å’Œä»¶æ•°ã€‚</p>`;
                valid = false;
                return;
            }

            // è®¡ç®—è¯¥æ‰¹è´§çš„æ€»ä½“ç§¯ (å•ä½: cmÂ³)
            const singleVolume_cm3 = L * W * H;
            totalCargoVolume_cm3 += singleVolume_cm3 * N;
            totalCargoCount += N;
        });

        if (!valid) return;
        if (totalCargoCount === 0) {
             resultsDiv.innerHTML = '<h3>è®¡ç®—ç»“æœ</h3><p>è¯·è‡³å°‘è¾“å…¥ä¸€ç§è´§ç‰©åŠå…¶ä»¶æ•°ã€‚</p>';
             return;
        }

        // 2. è´§æŸœä½“ç§¯æ•°æ® (è½¬æ¢å•ä½: mÂ³ -> cmÂ³)
        // è´§æŸœç†è®ºå†…éƒ¨ä½“ç§¯ (V_C) = Lc * Wc * Hc (cmÂ³)
        const containerVolume_cm3 = container.L * container.W * container.H;
        // è´§æŸœä½“ç§¯ (mÂ³)ï¼Œç”¨äºæ˜¾ç¤ºå’Œå¯¹æ¯”
        const containerVolume_m3 = containerVolume_cm3 / 1000000; 

        // 3. è®¡ç®—ä½“ç§¯åˆ©ç”¨ç‡
        const utilizationRate = (totalCargoVolume_cm3 / containerVolume_cm3) * 100;

        let outputHTML = '<h3>ä½“ç§¯ä¼°ç®—ç»“æœ</h3>';
        
        // ç»“æœåŒºåŸŸ
        outputHTML += `
            <div class="result-container-header">
                ğŸš¢ ${container.name} 
                ï¼ˆç†è®ºå®¹ç§¯: ${containerVolume_m3.toFixed(3)} mÂ³ï¼‰
            </div>
            <div class="volume-detail">
                <p><strong>ğŸ“¦ å¾…è£…è´§ç‰©æ€»ä»¶æ•°:</strong> ${totalCargoCount} ä»¶</p>
                <p><strong>ğŸ“¦ å¾…è£…è´§ç‰©æ€»ä½“ç§¯:</strong> ${(totalCargoVolume_cm3 / 1000000).toFixed(3)} mÂ³</p>
                <hr>
                <p><strong>âœ… ä½“ç§¯åˆ©ç”¨ç‡:</strong> ${utilizationRate.toFixed(2)} %</p>
        `;

        // 4. åˆ¤æ–­è£…è½½å¯è¡Œæ€§
        if (utilizationRate > 100) {
            outputHTML += `<p class="alert-danger">âš ï¸ è­¦å‘Šï¼šæ€»ä½“ç§¯ (${(totalCargoVolume_cm3 / 1000000).toFixed(3)} mÂ³) å·²è¶…è¿‡è´§æŸœç†è®ºå®¹ç§¯ (${containerVolume_m3.toFixed(3)} mÂ³)ï¼Œæ— æ³•è£…å…¥ï¼</p>`;
        } else if (utilizationRate > 85) {
             outputHTML += `<p class="alert-success">ğŸ‘ ç©ºé—´åˆ©ç”¨ç‡é«˜ (${utilizationRate.toFixed(2)}%)ã€‚ç†è®ºä½“ç§¯è¶³å¤Ÿï¼Œè¯·æ³¨æ„å®é™…æ‘†æ”¾å’Œå †å é—®é¢˜ã€‚</p>`;
        } else {
            outputHTML += `<p class="alert-success">ğŸ‘ ç†è®ºä½“ç§¯è¶³å¤Ÿ (${utilizationRate.toFixed(2)}%)ï¼Œæ‚¨è¿˜æœ‰ç©ºé—´è£…è½½æ›´å¤šè´§ç‰©ã€‚</p>`;
        }
        
        outputHTML += `</div>`;
        resultsDiv.innerHTML = outputHTML;
    }
</script>

</body>
</html>
